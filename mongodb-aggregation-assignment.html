<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Aggregation Pipelines Assignment</title>
    <style>
        :root {
            --primary-color: #4DB33D;
            --secondary-color: #2E7D32;
            --accent-color: #FF6F00;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --code-bg: #f6f8fa;
            --code-border: #d1d9e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, var(--light-bg) 0%, #e8f5e8 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .section h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--accent-color);
            display: inline-block;
        }

        .section h3 {
            color: var(--secondary-color);
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }

        .section h4 {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        .highlight-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .highlight-box strong {
            color: var(--secondary-color);
        }

        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--code-border);
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            line-height: 1.4;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .task-item {
            background: #f8f9fa;
            border-left: 4px solid var(--accent-color);
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }

        .task-item strong {
            color: var(--secondary-color);
        }

        .requirements {
            background: #fff3e0;
            border: 1px solid var(--accent-color);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .requirements ol {
            margin-left: 20px;
        }

        .requirements li {
            margin: 5px 0;
        }

        .file-list {
            background: var(--code-bg);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .file-list ul {
            list-style: none;
            padding: 0;
        }

        .file-list li {
            padding: 5px 0;
            font-family: monospace;
        }

        .file-list li:before {
            content: "ðŸ“„ ";
            margin-right: 8px;
        }

        .learning-objectives {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .learning-objectives h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .learning-objectives ul {
            list-style: none;
            padding: 0;
        }

        .learning-objectives li {
            padding: 8px 0;
            position: relative;
            padding-left: 25px;
        }

        .learning-objectives li:before {
            content: "âœ“";
            color: var(--primary-color);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .database-info {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 10px 10px 10px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .stat-card h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-card p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header {
                padding: 20px 15px;
            }

            h1 {
                font-size: 2rem;
            }

            .section {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MongoDB Aggregation Pipelines</h1>
            <p class="subtitle">Comprehensive Assignment</p>
        </header>

        <div class="section">
            <h2>Overview</h2>
            <p>This assignment provides hands-on practice with MongoDB aggregation pipelines through four different real-world scenarios. You'll work with various datasets to perform filtering, grouping, sorting, data transformation, and complex multi-stage analyses.</p>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>4 Scenarios</h4>
                    <p>Cities, E-commerce, Products, Students</p>
                </div>
                <div class="stat-card">
                    <h4>17 Tasks</h4>
                    <p>Progressive difficulty levels</p>
                </div>
                <div class="stat-card">
                    <h4>Auto-grading</h4>
                    <p>Immediate feedback system</p>
                </div>
                <div class="stat-card">
                    <h4>85 Points</h4>
                    <p>Maximum score available</p>
                </div>
            </div>

            <p>Each scenario includes:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Database and collection setup with sample data</li>
                <li>Step-by-step tasks of increasing complexity</li>
                <li>Specific output format requirements where applicable</li>
            </ul>
        </div>

        <div class="section">
            <h2>Submission Requirements</h2>
            <p>Submit <strong>4 MongoDB script files</strong> (.mongodb extension) in your repository:</p>

            <div class="file-list">
                <ul>
                    <li><code>scenario1.mongodb</code> - Solutions for Cities Data Analysis</li>
                    <li><code>scenario2.mongodb</code> - Solutions for E-commerce Analytics</li>
                    <li><code>scenario3.mongodb</code> - Solutions for Product Catalog Analytics</li>
                    <li><code>scenario4.mongodb</code> - Solutions for University Student Data</li>
                </ul>
            </div>

            <p>Each file should export an object with pipeline arrays for each task. Example file structure:</p>

            <div class="code-block">
                <pre>// scenario1.mongodb
module.exports = {
  part1: [ /* your pipeline for Part 1 */ ],
  part2_task1: [ /* pipeline for Part 2 Task 1 */ ],
  part2_task2: [ /* pipeline for Part 2 Task 2 */ ],
  part3: [ /* pipeline for Part 3 */ ],
  part4: [ /* pipeline for Part 4 */ ]
};</pre>
            </div>

            <div class="highlight-box">
                <strong>Important:</strong> Your pipelines will be automatically tested against expected results. Ensure your code is syntactically correct and follows MongoDB aggregation syntax.
            </div>
        </div>

        <div class="section">
            <h2>Scenario 1: Aggregation Pipelines & Data Analysis</h2>
            <div class="database-info">Database: geoDB</div>
            <div class="database-info">Collection: cities</div>

            <h3>Setup Data</h3>
            <div class="code-block">
                <pre>db.cities.insertMany([
    {"name": "Seoul", "country": "South Korea", "continent": "Asia", "population": 25.674 },
    {"name": "Mumbai", "country": "India", "continent": "Asia", "population": 19.980 },
    {"name": "Lagos", "country": "Nigeria", "continent": "Africa", "population": 13.463 },
    {"name": "Beijing", "country": "China", "continent": "Asia", "population": 19.618 },
    {"name": "Shanghai", "country": "China", "continent": "Asia", "population": 25.582 },
    {"name": "Osaka", "country": "Japan", "continent": "Asia", "population": 19.281 },
    {"name": "Cairo", "country": "Egypt", "continent": "Africa", "population": 20.076 },
    {"name": "Tokyo", "country": "Japan", "continent": "Asia", "population": 37.400 },
    {"name": "Karachi", "country": "Pakistan", "continent": "Asia", "population": 15.400 },
    {"name": "Dhaka", "country": "Bangladesh", "continent": "Asia", "population": 19.578 },
    {"name": "Rio de Janeiro", "country": "Brazil", "continent": "South America", "population": 13.293 },
    {"name": "SÃ£o Paulo", "country": "Brazil", "continent": "South America", "population": 21.650 },
    {"name": "Mexico City", "country": "Mexico", "continent": "North America", "population": 21.581 },
    {"name": "Delhi", "country": "India", "continent": "Asia", "population": 28.514 },
    {"name": "Buenos Aires", "country": "Argentina", "continent": "South America", "population": 14.967 },
    {"name": "Kolkata", "country": "India", "continent": "Asia", "population": 14.681 },
    {"name": "New York", "country": "United States", "continent": "North America", "population": 18.819 },
    {"name": "Manila", "country": "Philippines", "continent": "Asia", "population": 13.482 },
    {"name": "Chongqing", "country": "China", "continent": "Asia", "population": 14.838 },
    {"name": "Istanbul", "country": "Turkey", "continent": "Europe", "population": 14.751 }
]);</pre>
            </div>

            <h3>Tasks</h3>

            <h4>Part 1: Basic Filtering & Sorting</h4>
            <div class="task-item">
                Create a pipeline to find all cities situated in <strong>"South America"</strong>. Arrange the resulting list alphabetically by the city <code>name</code> (A to Z).
            </div>

            <h4>Part 2: Grouping & Analysis</h4>
            <div class="task-item">
                <strong>1. Average Population by Continent</strong><br>
                Analyze the data to find the <strong>average population</strong> for each continent in the dataset.
            </div>
            <div class="task-item">
                <strong>2. Counting Cities per Country</strong><br>
                Identify which countries have multiple major cities in our list. Return only the countries that have <strong>2 or more</strong> cities in this dataset, along with their city count.
            </div>

            <h4>Part 3: Data Transformation</h4>
            <div class="task-item">
                <strong>Reshaping Output</strong><br>
                Return a list of all cities in <strong>"Asia"</strong>, but reshape the output documents to match a specific format. The output documents must strictly contain <strong>only</strong> two fields:
                <ul style="margin-top: 10px;">
                    <li><code>city</code>: The name of the city.</li>
                    <li><code>pop</code>: The population of the city.</li>
                </ul>
                (Ensure no other fields, such as <code>_id</code> or <code>country</code>, appear in the output).
            </div>

            <h4>Part 4: Complex Multi-Stage Pipeline</h4>
            <div class="task-item">
                <strong>The "Mega-City" Analysis</strong><br>
                Perform a multi-step analysis to find specific "Mega-Cities" (population > 15 million).
            </div>
            <div class="requirements">
                <strong>Requirements:</strong>
                <ol>
                    <li>Filter the data to include only cities with a population <strong>greater than 15 million</strong>.</li>
                    <li>For each continent, calculate the <strong>total population</strong> of these mega-cities.</li>
                    <li>Sort the final results by this total population in <strong>descending order</strong>.</li>
                    <li>Format the final output documents to look exactly like this example:<br>
                        <code>{ "region": "Asia", "total_mega_pop": 125.5 }</code>
                    </li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>Scenario 2: E-commerce Analytics</h2>
            <div class="database-info">Database: shopDB</div>
            <div class="database-info">Collection: orders</div>

            <h3>Setup Data</h3>
            <div class="code-block">
                <pre>db.orders.insertMany([
  { "orderId": 101, "customer": "Alice", "status": "completed", "total": 1200, "items": 3 },
  { "orderId": 102, "customer": "Bob", "status": "pending", "total": 450, "items": 1 },
  { "orderId": 103, "customer": "Alice", "status": "completed", "total": 700, "items": 2 },
  { "orderId": 104, "customer": "Charlie", "status": "cancelled", "total": 200, "items": 1 },
  { "orderId": 105, "customer": "Bob", "status": "completed", "total": 300, "items": 1 },
  { "orderId": 106, "customer": "David", "status": "completed", "total": 1500, "items": 4 },
  { "orderId": 107, "customer": "Alice", "status": "pending", "total": 100, "items": 1 },
  { "orderId": 108, "customer": "Eve", "status": "completed", "total": 2500, "items": 5 },
  { "orderId": 109, "customer": "Charlie", "status": "completed", "total": 450, "items": 2 },
  { "orderId": 110, "customer": "Eve", "status": "cancelled", "total": 0, "items": 0 }
]);</pre>
            </div>

            <h3>Tasks</h3>

            <h4>Part 1: Simple Filter & Project</h4>
            <div class="task-item">
                <strong>Completed Orders Report</strong><br>
                Find orders with status <strong>"completed"</strong>. Return only the <code>customer</code> name and the <code>total</code> amount.
            </div>

            <h4>Part 2: Grouping & Aggregation</h4>
            <div class="task-item">
                <strong>Average Transaction Value</strong><br>
                Calculate the <strong>average order value</strong> for all "completed" orders.<br>
                <em>(Hint: Match first, then Group by null)</em>
            </div>

            <h4>Part 3: Multi-Stage Analysis</h4>
            <div class="task-item">
                <strong>Customer Lifetime Value (CLV)</strong>
                <ol style="margin-top: 10px;">
                    <li><strong>Match:</strong> Filter for "completed" orders only.</li>
                    <li><strong>Group:</strong> Group by <code>customer</code> and sum their total spend.</li>
                    <li><strong>Sort:</strong> Order customers by total spend (Highest first).</li>
                </ol>
            </div>

            <h4>Part 4: The VIP Pipeline (Advanced)</h4>
            <div class="task-item">
                <strong>High-Value Customer Report</strong><br>
                Identify "VIP Customers" who have spent more than 1000 in total.
            </div>
            <div class="requirements">
                <strong>Pipeline Stages Required:</strong>
                <ol>
                    <li><strong>Match:</strong> Filter only "completed" orders.</li>
                    <li><strong>Group:</strong> Group by customer and calculate <code>totalSpent</code>.</li>
                    <li><strong>Match:</strong> Filter the <em>grouped</em> results to keep only customers with <code>totalSpent > 1000</code>.</li>
                    <li><strong>Sort:</strong> Sort by <code>totalSpent</code> descending.</li>
                    <li><strong>Project:</strong> Format the output to: <code>{ "VIP_Name": "Alice", "Grand_Total": 1900 }</code>.</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>Scenario 3: Product Catalog Analytics</h2>
            <div class="database-info">Database: techDB</div>
            <div class="database-info">Collection: phones</div>

            <h3>Setup Data</h3>
            <div class="code-block">
                <pre>db.phones.insertMany([
  { "model": "Pixel 6", "brand": "Google", "price": 599, "features": ["5G", "OLED", "NFC"] },
  { "model": "iPhone 13", "brand": "Apple", "price": 799, "features": ["5G", "FaceID", "NFC"] },
  { "model": "Galaxy S21", "brand": "Samsung", "price": 750, "features": ["5G", "AMOLED", "Wireless Charging"] },
  { "model": "iPhone SE", "brand": "Apple", "price": 399, "features": ["TouchID", "4G"] },
  { "model": "Galaxy A52", "brand": "Samsung", "price": 350, "features": ["4G", "AMOLED"] },
  { "model": "Pixel 5a", "brand": "Google", "price": 449, "features": ["5G", "OLED"] },
  { "model": "iPhone 13 Pro", "brand": "Apple", "price": 999, "features": ["5G", "FaceID", "LiDAR", "OLED"] },
  { "model": "OnePlus 9", "brand": "OnePlus", "price": 729, "features": ["5G", "Fast Charging"] }
]);</pre>
            </div>

            <h3>Tasks</h3>

            <h4>Part 1: Basic Stats</h4>
            <div class="task-item">
                <strong>Brand Pricing Report</strong><br>
                Calculate the average price for each brand and reshape the output to show <code>BrandName</code> and <code>AvgPrice</code>.
            </div>

            <h4>Part 2: Array Unwinding</h4>
            <div class="task-item">
                <strong>Feature Mining</strong>
                <ol style="margin-top: 10px;">
                    <li><strong>Unwind:</strong> Deconstruct the <code>features</code> array.</li>
                    <li><strong>Group:</strong> Count how many times each feature appears.</li>
                    <li><strong>Sort:</strong> Show the most popular features at the top.</li>
                </ol>
            </div>

            <h4>Part 3: Pipeline Filtering</h4>
            <div class="task-item">
                <strong>Premium Filter</strong><br>
                Find phones priced over $700. Project only the Model and Price. Sort by Price descending.
            </div>

            <h4>Part 4: Multi-Stage 5G Analysis (Advanced)</h4>
            <div class="task-item">
                <strong>5G Market Leaders</strong><br>
                Analyze which brands offer the most affordable 5G phones.
            </div>
            <div class="requirements">
                <strong>Pipeline Stages Required:</strong>
                <ol>
                    <li><strong>Match:</strong> Filter to find phones that have "5G" in their features array.</li>
                    <li><strong>Group:</strong> Group by <code>brand</code> and calculate the <strong>average price</strong> of their 5G phones.</li>
                    <li><strong>Sort:</strong> Sort by average price ascending (Cheapest brand first).</li>
                    <li><strong>Project:</strong> Format the output: <code>{ "Brand": "Google", "Avg_5G_Price": 524 }</code>.</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>Scenario 4: University Student Data</h2>
            <div class="database-info">Database: uniDB</div>
            <div class="database-info">Collection: students</div>

            <h3>Setup Data</h3>
            <div class="code-block">
                <pre>db.students.insertMany([
  { "name": "John Doe", "major": "CS", "gpa": 3.8, "year": 4 },
  { "name": "Jane Smith", "major": "Math", "gpa": 3.9, "year": 3 },
  { "name": "Jim Brown", "major": "CS", "gpa": 2.7, "year": 2 },
  { "name": "Jake White", "major": "History", "gpa": 3.2, "year": 4 },
  { "name": "Jill Green", "major": "Math", "gpa": 4.0, "year": 1 },
  { "name": "Jack Black", "major": "CS", "gpa": 3.5, "year": 4 },
  { "name": "Jerry Blue", "major": "History", "gpa": 2.9, "year": 3 },
  { "name": "Jenny Gold", "major": "CS", "gpa": 3.9, "year": 3 }
]);</pre>
            </div>

            <h3>Tasks</h3>

            <h4>Part 1: Department Stats</h4>
            <div class="task-item">
                <strong>GPA by Major</strong>
                <ol style="margin-top: 10px;">
                    <li><strong>Group:</strong> Group by <code>major</code>.</li>
                    <li><strong>Accumulate:</strong> Calculate Min, Max, and Avg GPA.</li>
                    <li><strong>Project:</strong> Rename fields to <code>Department</code>, <code>AvgGPA</code>, etc.</li>
                </ol>
            </div>

            <h4>Part 2: Senior Analysis</h4>
            <div class="task-item">
                <strong>Top Seniors</strong><br>
                Find Seniors (Year 4) with GPA > 3.5. Project only Name and Major. Sort by GPA descending.
            </div>

            <h4>Part 3: Enrollment</h4>
            <div class="task-item">
                <strong>Students per Year</strong><br>
                Group by Year, Count students, and Sort by Year (ascending). Project output as <code>{ "Year": 1, "Count": 2 }</code>.
            </div>

            <h4>Part 4: Department Honor Roll (Advanced)</h4>
            <div class="task-item">
                <strong>Best Performing Majors</strong><br>
                Identify which majors have the smartest students (GPA >= 3.5).
            </div>
            <div class="requirements">
                <strong>Pipeline Stages Required:</strong>
                <ol>
                    <li><strong>Match:</strong> Filter to include only students with <code>gpa >= 3.5</code>.</li>
                    <li><strong>Group:</strong> Group by <code>major</code> and count how many "Honor Students" are in that major.</li>
                    <li><strong>Sort:</strong> Sort by the count of honor students in descending order.</li>
                    <li><strong>Limit:</strong> Keep only the top 2 majors.</li>
                    <li><strong>Project:</strong> Output: <code>{ "Major": "CS", "Honor_Student_Count": 3 }</code>.</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>Submission Guidelines</h2>
            <ul style="margin-left: 20px;">
                <li>Create 4 MongoDB script files as specified above</li>
                <li>Test your pipelines locally in MongoDB before submitting</li>
                <li>Ensure output formats match the specifications exactly where required</li>
                <li>The autograding system will run your pipelines and compare results to expected outputs</li>
                <li>Points will be awarded based on correct pipeline logic and output matching</li>
            </ul>
        </div>

        <div class="learning-objectives">
            <h3>Learning Objectives</h3>
            <p>By completing this assignment, you will demonstrate proficiency in:</p>
            <ul>
                <li>Basic aggregation pipeline stages ($match, $group, $sort, $project)</li>
                <li>Array operations ($unwind)</li>
                <li>Multi-stage pipeline construction</li>
                <li>Data filtering and transformation</li>
                <li>Output formatting and projection</li>
            </ul>
        </div>
    </div>
</body>
</html>